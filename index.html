<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>පුද්ගලයින් ලියාපදිංචිය - CleanSriLanka වැලිගම</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Diagnostics banner -->
    <div id="diagnostics" style="width:100%;text-align:center;padding:6px 0;font-weight:bold;display:none;"></div>
    <!-- Top-left Home button -->
    <button id="top-home-btn" class="top-home" title="Home" aria-label="Home">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 9.5L12 3l9 6.5" />
        <path d="M9 22V12h6v10" />
      </svg>
    </button>
    <div id="main-content">
      <main class="container">
        <div style="display:flex;align-items:center;justify-content:center;gap:24px;margin-bottom:0.2em;">
          <img src="images/statelogo.png" alt="Left Logo" class="logo-img" />
          <div>
            <h2 style="text-align:center;font-size:2.2em;color:#2b7a78;margin-bottom:0.2em;font-weight:bold;margin:0;">සතුටු රටක් Clean Sri Lanka ගමින් ගමට</h2>
            <div style="text-align:center;font-size:1.3em;color:#205072;margin-bottom:1em;">වැලිගම ප්‍රාදේශීය ලේකම් කාර්යාලය</div>
          </div>
          <img src="images/csllogo.png" alt="Right Logo" class="logo-img" />
        </div>
     

        <section class="card" id="home-card">
          <h2>Summary</h2>
          <div id="dashboard-stats" style="display:flex;justify-content:center;gap:32px;margin-bottom:18px;text-align:center;font-size:1.1em;"></div>
          <div id="dashboard-new" style="display:flex;justify-content:center;gap:32px;margin-bottom:18px;text-align:center;font-size:1.1em;"></div>
          <div class="chart-wrap">
            <canvas id="summaryChart" width="400" height="180"></canvas>
          </div>
          <div class="home-actions" style="display:flex;justify-content:center;gap:20px;margin-top:24px;">
            <button id="goto-insert" class="big">Insert Data</button>
            <button id="goto-search" class="big">Search Data</button>
            <button id="new-front-btn" class="big">Admin only</button>
          </div>
        </section>

        <section id="insert-card" class="card" style="display:none;">
          <div id="last-token-row" style="margin-bottom:12px;font-weight:500;color:#205072;"></div>
          <h2> නව ලියාපදිංචිය/New Registration</h2>
          <form id="entry-form">
            <label> ටෝකන් අංකය/Token No <span class="req">*</span><input type="text" id="token" required /></label>
            <label> හැඳුනුම්පත් අංකය/ NIC<input type="text" id="nic" /></label>
            <label> දුරකථන අංකය/ Phone<input type="text" id="phone" /></label>
            <label> නම/ Name<span class="req">*</span><input type="text" id="name" required /></label>
            <label> ලිපිනය/ Address<span class="req">*</span><textarea id="address" rows="2" required></textarea></label>
            <label> ගැටළුව/ Problem<span class="req">*</span><textarea id="problem" rows="3" required></textarea></label>
            <label> යොමු කරන ලද ආයතනය / Institute
              <select id="institute" required>
                <option value="">-- ආයතනය තෝරන්න / Select Institute --</option>
              </select>
              <button type="button" id="manual-institute-btn" style="margin-left:8px;">Institute not in list?</button>
              <input type="text" id="manual-institute" placeholder="Enter institute name" style="display:none;margin-top:8px;" />
            </label>
            <div class="actions">
              <button type="submit"> තොරතුරු යවන්න</button>
              <span id="entry-status" class="status"></span>
            </div>
          </form>
        </section>

        <section id="search-card" class="card" style="display:none;">
          <h2>Search Reports</h2>
          <div class="search-row">
            <input id="search-input" placeholder="Enter Token No" />
            <button id="search-btn">Search</button>
          </div>
          <div id="search-result" style="margin-top:18px;"></div>
          <form id="search-update-form" style="display:none;margin-top:18px;">
            <label>Status
              <select id="search-status">
                <option value="">-- choose --</option>
                <option value="solved">Solved</option>
                <option value="not solved">Not Solved</option>
              </select>
            </label>
            <label>Note
              <textarea id="search-note" rows="2" style="width:100%;"></textarea>
            </label>
            <button type="submit" style="margin-top:10px;">Update</button>
            <span id="search-update-status" class="status"></span>
          </form>
        </section>

        <section id="admin-card" class="card" style="display:none;">
          <h2>Admin Only</h2>
          <div style="display:flex;justify-content:center;gap:16px;margin-bottom:12px;">
            <button id="filter-all" class="big">All</button>
            <button id="filter-solved" class="big">Solved</button>
            <button id="filter-not-solved" class="big">Not Solved</button>
            <button id="filter-new" class="big">New</button>
            <button id="export-excel" class="big">Export to Excel</button>
          </div>
          <div id="admin-search-result" style="margin-top:18px;"></div>
        </section>

        <section id="login-card" class="card" style="display:none;max-width:350px;margin:32px auto;">
          <h2>Login</h2>
          <form id="login-form">
            <label>Username<input type="text" id="login-username" required /></label>
            <label>Password<input type="password" id="login-password" required /></label>
            <div class="actions">
              <button type="submit">Login</button>
              <span id="login-status" class="status"></span>
            </div>
          </form>
        </section>
        <section class="card" id="detail-card" style="display:none;">
          <h2>Report Detail</h2>
          <div id="detail"></div>

          <form id="update-form">
            <label>Status
              <select id="status">
                <option value="">-- choose --</option>
                <option value="solved">Solved</option>
                <option value="not solved">Not Solved</option>
              </select>
            </label>
            <label>Note<textarea id="note" rows="3"></textarea></label>
            <div class="actions">
              <button type="submit">Submit Update</button>
              <span id="update-status" class="status"></span>
            </div>
          </form>
        </section>
      </main>
    </div>
    <!-- Supabase JS client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <!-- Chart.js for summary graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- User-supplied config (edit with your keys) -->
    <script src="config.js"></script>
    <script src="script.js"></script>
    <footer style="width:100%;text-align:center;padding:16px 0 8px 0;color:#fff;font-size:1em;background:#000;margin-top:32px;">
      &copy; Copyright Divisional Secretariat Weligama
    </footer>
  </body>
</html>
